---
page_type: sample
products:
- ms-graph
languages:
- csharp
extensions:
  contentType: samples 
  technologies:
  - Microsoft Graph
  createdDate: 5/25/2017 5:03:53 PM
---
# ConsoleApp-MicrosoftGraphAPI-DeltaQuery-DotNet

Это консольное приложение демонстрирует, как отправлять разностные запросы к API Graph, позволяя приложениям запрашивать только измененные данные из клиентов Microsoft Graph.

Используемый пример демонстрирует, как можно выполнять вызовы графа с помощью Graph SDK и как можно обрабатывать ответы.

Конкретный пример, используемый в этом примере, включает мониторинг изменений (добавление и удаление) MailFolders в учетной записи электронной почты отдельного человека.

## Как запустить этот образец

Для запуска этого примера вам понадобятся:
- Visual Studio 2017
- подключение к Интернету
- клиент Azure Active Directory (Azure AD). Дополнительную информацию о том, как получить клиента Azure AD, см. В разделе [Как получить клиента Azure AD](https://azure.microsoft.com/en-us/documentation/articles/active-directory-howto-tenant/). 

### Шаг 1. Клонировать или скачать этот репозиторий

Из вашей оболочки или командной строки:

`git clone https://github.com/microsoftgraph/ConsoleApp-DeltaQuery-DotNet`

### Шаг 2. Зарегистрируйте образец приложения у своего клиента Azure Active Directory.

В этом примере есть один проект. Чтобы зарегистрировать его, вы можете:

- или выполните действия, описанные [шаге 2. Зарегистрируйте пример в клиенте Azure Active Directory](#step-2-register-the-sample-with-your-azure-active-directory-tenant) и [шаг 3. Настройка примера для использования клиента Azure AD](#choose-the-azure-ad-tenant-where-you-want-to-create-your-applications)
- или используйте сценарии PowerShell, которые:
  - **автоматически** создает приложения Azure AD и связанные с ними объекты (пароли, разрешения, зависимости)
  - изменить файлы конфигурации проектов Visual Studio.

Если вы хотите использовать эту автоматизацию:

1. В Windows запустите PowerShell и перейдите в корень клонированного каталога.
1. В PowerShell запустите:

   ```PowerShell
   Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope Process -Force
   ```

1. Запустите сценарий, чтобы создать приложение Azure AD и соответствующим образом настроить код примера приложения.

   ```PowerShell
   .\AppCreationScripts\Configure.ps1
   ```

   > Другие способы запуска сценариев описаны в [сценариях создания приложений](./AppCreationScripts/AppCreationScripts.md)

1. Откройте решение Visual Studio и нажмите кнопку "Пуск"

Если вы не хотите использовать эту автоматизацию, выполните следующие действия

#### Выберите клиента Azure AD, в котором вы хотите создавать свои приложения

Сначала вам потребуется выполнить следующие действия:

1. Войдите на [портал Azure](https://portal.azure.com) с помощью личной учетной записи Майкрософт либо рабочей или учебной учетной записи.
1. Если ваша учетная запись предоставляет вам доступ более чем к одному арендатору, выберите свою учетную запись в верхнем правом углу и задайте для сеанса портала нужный клиент Azure AD (с помощью **Switch Directory**).
1. В левой области навигации выберите службу **Azure Active Directory**, а затем выберите **Регистрация приложений (предварительный просмотр)**.

#### Регистрация клиентского приложения (ConsoleApp-DeltaQuery-DotNet)

1. На странице **регистрации приложений (Предварительный просмотр)** выберите **Зарегистрировать приложение**.
1. Когда появится страница **Зарегистрировать приложение**, введите регистрационную информацию вашего приложения:
   - В разделе **имя** введите понятное имя приложения, которое будет отображаться для пользователей приложения, например `ConsoleApp-DeltaQuery-DotNet`.
   - В разделе **Поддерживаемые типы учетных записей** выберите **Учетные записи в любом каталоге организации и личные учетные записи Майкрософт (например, Skype, Xbox, Outlook.com)**.
   - Выберите **Зарегистрировать**, чтобы создать приложение.
1. На странице **Обзор** приложения найдите значение **Идентификатор приложения (клиент)** и запишите его для последующего использования. Для этого проекта вам потребуется настроить файл конфигурации Visual Studio.
1. В списке страниц приложения выберите **проверку подлинности**
   - В *предложенных URI перенаправления для общедоступных клиентов (мобильных, настольных)* установите второй флажок, чтобы приложение могло работать с библиотеками MSAL, используемыми в приложении. (Поле должно содержать параметр *urn:ietf:wg:oauth:2.0:oob*). 
1. В списке страниц приложения выберите **Разрешения API**
   - Нажмите кнопку **Добавить разрешение** и
   - Убедитесь, что выбрана вкладка **Интерфейсы API Microsoft**
   - В разделе *Часто используемые интерфейсы API Microsoft* щелкните **Microsoft Graph**
   - Убедитесь, что в разделе **Делегированные разрешения** выбраны правильные разрешения. **Mail.Read**. При необходимости используйте поле поиска.
   - Нажмите кнопку **Добавить разрешения**

### Этап 3. Настройка примера для использования клиента Azure AD

В приведенных ниже инструкциях ClientID — это то же самое, что и "код приложения" или "AppId".

Откройте решение в Visual Studio для настройки проектов

#### Настроить клиентский проект

1. В папке *ConsoleApplication* переименуйте `appsettings.json.example` файл, чтобы `appSettings.json`
1. Откройте и отредактируйте файл `appsettings.json`, чтобы внести следующие изменения
    1. Найдите строку, где `ClientId`установлен как `YOUR_CLIENT_ID_HERE`, и замените существующее значение идентификатором приложения (clientId) приложения `ConsoleApp-DeltaQuery-DotNet`, скопированным с портала Azure.

Очистите решение, перестройте решение и запустите его в отладчике.

## Участие

Если вы хотите добавить код в этот пример, просмотрите статью [CONTRIBUTING.MD](/CONTRIBUTING.md).

Этот проект соответствует [Правилам поведения разработчиков открытого кода Майкрософт](https://opensource.microsoft.com/codeofconduct/). Дополнительные сведения см. в разделе [часто задаваемых вопросов о правилах поведения](https://opensource.microsoft.com/codeofconduct/faq/). Если у вас возникли вопросы или замечания, напишите нам по адресу [opencode@microsoft.com](mailto:opencode@microsoft.com).

## Вопросы и комментарии

Мы хотели бы получить ваши отзывы о образце Microsoft Graph Webhooks с помощью WebJobs SDK. Вы можете отправлять нам вопросы и предложения в разделе [Проблемы](https://github.com/microsoftgraph/ConsoleApp-DeltaQuery-DotNet/issues) этого репозитория.

Общие вопросы о Microsoft Graph следует задавать на сайте [Stack Overflow](https://stackoverflow.com/questions/tagged/MicrosoftGraph). Убедитесь, что ваши вопросы или комментарии содержат метку *\[MicrosoftGraph]*.

Если у вас есть предложение по функции, пожалуйста, опубликуйте свою идею на нашей странице [Голос пользователя](https://officespdev.uservoice.com/) и проголосуйте за ваши предложения.

## Дополнительные ресурсы

- [AAD DQ пример](https://github.com/Azure-Samples/active-directory-dotnet-graphapi-diffquery)
- [Использование разностного запроса в Microsoft Graph](https://developer.microsoft.com/en-us/graph/docs/concepts/delta_query_overview)
- [Сайт разработчика Microsoft Graph](https://developer.microsoft.com/en-us/graph/)
- [Вызов Microsoft Graph в приложении ASP.NET MVC](https://developer.microsoft.com/en-us/graph/docs/platform/aspnetmvc)
- [MSAL.NET](https://aka.ms/msal-net)

© Корпорация Майкрософт (Microsoft Corporation), 2019. Все права защищены.
